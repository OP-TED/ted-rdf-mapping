prefixes:
 epo: "http://data.europa.eu/a4g/ontology#"
 locn: "http://locn/ontology#"
 grel: "http://users.ugent.be/~bjdmeest/function/grel.ttl#"
mappings:
  buyer:
    sources:
      - [data.json~jsonpath, "$.TED_EXPORT"]
    s:
      function: grel:array_join
      parameters:
        - [grel:p_array_a, "http://data.europa.eu/a4g/ontology#Buyer"]
        - parameter: grel:p_array_a
          value:
            function: grel:string_md5
            parameters: 
              - [grel:valueParameter, "Buyer"] # This is needed atm, bug in the YARRRML parser
    po:
      - [a, epo:Buyer]
      - p: epo:IsRoleOf
        o:
          - function: grel:array_join
            parameters:
              - [grel:p_array_a, epo:Organisation]
              - parameter: grel:p_array_a
                value:
                  function: grel:string_md5
                  parameters: 
                    - [grel:valueParameter, $(FORM_SECTION.F03_2014.CONTRACTING_BODY.ADDRESS_CONTRACTING_BODY.OFFICIALNAME)]
            datatype: rr:IRI
  organisation:
    sources:
      - [data.json~jsonpath, "$.TED_EXPORT"]
    s:
      function: grel:array_join
      parameters:
        - [grel:p_array_a, "http://data.europa.eu/a4g/ontology#Organisation"]
        - parameter: grel:p_array_a
          value:
            function: grel:string_md5
            parameters: 
              - [grel:valueParameter, $(FORM_SECTION.F03_2014.CONTRACTING_BODY.ADDRESS_CONTRACTING_BODY.OFFICIALNAME)]
    po:
      - [a, epo:Organisation]
      - p: epo:hasRegisteredAddress
        o:
          function: grel:array_join
          parameters:
            - [grel:p_array_a, epo:]
            - parameter: grel:p_array_a
              value:
                function: grel:string_md5
                parameters: 
                  - [grel:valueParameter, $(FORM_SECTION.F03_2014.CONTRACTING_BODY.ADDRESS_CONTRACTING_BODY.ADDRESS)]

      - [epo:hasName, $(FORM_SECTION.F03_2014.CONTRACTING_BODY.ADDRESS_CONTRACTING_BODY.OFFICIALNAME)]
      - [epo:hasIdentifier, $(FORM_SECTION.F03_2014.CONTRACTING_BODY.ADDRESS_CONTRACTING_BODY.NATIONALID)]
      
  address:
    sources:
      - [data.json~jsonpath, "$.TED_EXPORT"]
    s:
      function: grel:array_join
      parameters:
        - [grel:p_array_a, "http://locn/ontology#Address"]
        - parameter: grel:p_array_a
          value:
            function: grel:string_md5
            parameters: 
              - [grel:valueParameter, $(FORM_SECTION.F03_2014.CONTRACTING_BODY.ADDRESS_CONTRACTING_BODY.ADDRESS)]

    po:
      - [a, locn:Address]
      - [locn:postName, $(FORM_SECTION.F03_2014.CONTRACTING_BODY.ADDRESS_CONTRACTING_BODY.TOWN)]
      - [locn:thoroughfare, $(FORM_SECTION.F03_2014.CONTRACTING_BODY.ADDRESS_CONTRACTING_BODY.ADDRESS)]
      - [locn:postCode, $(FORM_SECTION.F03_2014.CONTRACTING_BODY.ADDRESS_CONTRACTING_BODY.POSTAL_CODE)]
      - [locn:adminUnitL2, $(FORM_SECTION.F03_2014.CONTRACTING_BODY.ADDRESS_CONTRACTING_BODY.n2016:NUTS.-CODE)]
      - [locn:adminUnitL1, $(FORM_SECTION.F03_2014.CONTRACTING_BODY.ADDRESS_CONTRACTING_BODY.COUNTRY.-VALUE)]